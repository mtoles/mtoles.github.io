<!DOCTYPE html>
<html>

<head>
    <title>Google Maps Place Details</title>
    <style>
        html,
        body,
        #map_canvas {
            height: 500px;
            width: 500px;
            margin: 0px;
            padding: 0px;
        }
    </style>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBAkArK5U1zyba6jkaKycU5S1vNpBKLTHs&libraries=places&callback=initialize"></script>
    <script>
        function initialize() {








            var map = new google.maps.Map(document.getElementById("map_canvas"), {
                center: new google.maps.LatLng(37.4419, -122.1419),
                zoom: 13,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });

            var request = {
                placeId: 'ChIJOwE7_GTtwokRFq0uOwLSE9g'
            };

            var infowindow = new google.maps.InfoWindow();
            var service = new google.maps.places.PlacesService(map);

            service.getDetails(request, function (place, status) {
                if (status == google.maps.places.PlacesServiceStatus.OK) {
                    var marker = new google.maps.Marker({
                        map: map,
                        position: place.geometry.location
                    });

                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.setContent(place.name);
                        infowindow.open(map, this);
                    });

                    map.fitBounds(place.geometry.viewport);
                }
            });


            fetch("https://128.59.18.156:55244/places").then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                alert("test fetch");
                console.log("alert")
                return response.json();
            })
                .then(data => {
                    var infowindow = new google.maps.InfoWindow({
                        content: "Loading..."
                    });
                    alert("test fetch 2");

                    data.forEach(place => {
                        alert("test for each");

                        if (place.owner == null) {
                            var color = "rgb(111,111,111)";
                        }
                        else
                            var color = stringToRandomColor(place.owner);
                        var marker = new google.maps.Marker({
                            map: map,
                            // position: place.geometry
                            position: new google.maps.LatLng(place.geometry.location.lat, place.geometry.location.lng),
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 12,
                                fillColor: color,
                                fillOpacity: 0.8,
                                strokeColor: "black",
                                strokeWeight: 3
                            }
                        });

                        google.maps.event.addListener(marker, 'click', function () {
                            infowindow.setContent(infoWindowDiv(place));
                            infowindow.open(map, this);
                        });

                    });
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
        }

        google.maps.event.addDomListener(window, "load", initialize);
    </script>
</head>

<body>
    <div id="map_canvas" style="width:750px; height:450px; border: 2px solid #3872ac;"></div>
</body>

</html>